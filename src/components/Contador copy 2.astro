---
// =============================================================================
// ContadorSection.astro - Sección de Contador con efecto de respiración elegante
// =============================================================================

const config = {
  imagenFondo: "/imagenes/fondo3.webp",
  textoDecorativo: "Solo Faltan",
  fechaEvento: "2025-12-28T17:00:00",
  altImagen: "Fondo elegante para contador",
  etiquetas: {
    dias: "DÍAS",
    horas: "HORAS",
    minutos: "MINUTOS",
    segundos: "SEGUNDOS"
  }
};
---

<section 
  class="relative w-full h-screen flex items-center justify-center overflow-hidden"
  aria-label="Contador regresivo"
  id="contador-section"
>
  
  <!-- ✨ FONDO CON EFECTO ELEGANTE DE RESPIRACIÓN ✨ -->
  <div class="hero-bg absolute inset-0 z-0 opacity-0">
    <img 
      src={config.imagenFondo}
      alt={config.altImagen}
      class="w-full h-full object-cover"
      loading="lazy"
    />
    <!-- Overlay idéntico -->
    <div class="absolute inset-0 bg-black/40"></div>
  </div>

  <!-- CONTENIDO DEL CONTADOR (centrado, sobre el fondo) -->
  <div class="relative z-10 w-full max-w-md mx-auto px-6 text-center">
    
    <h2 
      class="font-great-vibes text-4xl md:text-5xl lg:text-6xl text-white mb-8 drop-shadow-lg opacity-0"
      style="transform: translateY(30px);"
      id="texto-decorativo"
    >
      {config.textoDecorativo}
    </h2>

    <div 
      class="contador-grid grid grid-cols-4 gap-3 md:gap-4 opacity-0"
      style="transform: translateY(40px);"
      id="contador-grid"
    >
      <!-- DÍAS -->
      <div class="contador-item">
        <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 md:p-5 border border-white/20 shadow-xl">
          <div class="text-4xl md:text-5xl font-bold text-white mb-2 font-charm" id="dias">00</div>
          <div class="text-xs md:text-sm text-white/90 font-medium tracking-wider font-charm">{config.etiquetas.dias}</div>
        </div>
      </div>

      <!-- HORAS -->
      <div class="contador-item">
        <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 md:p-5 border border-white/20 shadow-xl">
          <div class="text-4xl md:text-5xl font-bold text-white mb-2 font-charm" id="horas">00</div>
          <div class="text-xs md:text-sm text-white/90 font-medium tracking-wider font-charm">{config.etiquetas.horas}</div>
        </div>
      </div>

      <!-- MINUTOS -->
      <div class="contador-item">
        <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 md:p-5 border border-white/20 shadow-xl">
          <div class="text-4xl md:text-5xl font-bold text-white mb-2 font-charm" id="minutos">00</div>
          <div class="text-xs md:text-sm text-white/90 font-medium tracking-wider font-charm">{config.etiquetas.minutos}</div>
        </div>
      </div>

      <!-- SEGUNDOS -->
      <div class="contador-item">
        <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 md:p-5 border border-white/20 shadow-xl">
          <div class="text-4xl md:text-5xl font-bold text-white mb-2 font-charm" id="segundos">00</div>
          <div class="text-xs md:text-sm text-white/90 font-medium tracking-wider font-charm">{config.etiquetas.segundos}</div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* Efecto de pulso en números */
  @keyframes pulse-number {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }
  #dias, #horas, #minutos, #segundos {
    animation: pulse-number 1s ease-in-out infinite;
  }

  /* Sombras para mejor contraste */
  .contador-item {
    filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
  }

  @media (max-width: 640px) {
    .contador-item {
      font-size: 0.9rem;
    }
  }
</style>

<!-- ✅ SCRIPT CON EFECTO DE RESPIRACIÓN ELEGANTE -->
<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener('DOMContentLoaded', () => {
    const section = document.getElementById('contador-section');
    const heroImage = section?.querySelector('.hero-bg img');
    const heroBg = section?.querySelector('.hero-bg');

    if (!heroImage || !heroBg || !section) return;

    // =========================================================
    // ANIMACIÓN INICIAL - ENTRADA DRAMÁTICA
    // =========================================================
    const tl = gsap.timeline({ 
      defaults: { 
        ease: 'power3.out' 
      },
      scrollTrigger: {
        trigger: section,
        start: 'top 80%',
        toggleActions: 'play none none none'
      }
    });

    // Fade in del fondo
    tl.to(heroBg, {
      opacity: 1,
      duration: 1.5,
      ease: 'power2.out'
    }, 0);

    // Zoom inicial dramático (de grande a normal)
    tl.fromTo(heroImage,
      { scale: 1.3 },
      { 
        scale: 1.05, // Termina un poco más grande para el efecto de respiración
        duration: 2.5, 
        ease: 'power2.out',
        onComplete: () => {
          // =========================================================
          // EFECTO DE RESPIRACIÓN CONTINUO Y ELEGANTE
          // =========================================================
          gsap.to(heroImage, {
            scale: 1.08,
            duration: 4,
            ease: 'sine.inOut',
            yoyo: true,
            repeat: -1
          });
        }
      }
    , 0);

    // Animación del texto decorativo
    tl.to('#texto-decorativo', {
      y: 0,
      opacity: 1,
      scale: 1,
      duration: 1.5,
      ease: 'power4.out'
    }, 0.5);

    // Animación del grid del contador
    tl.to('#contador-grid', {
      y: 0,
      opacity: 1,
      scale: 1,
      duration: 1.2,
      ease: 'back.out(1.2)'
    }, 0.8);

    // =========================================================
    // CONTADOR REGRESIVO - 28 de Diciembre 2025, 17:00
    // =========================================================
    const fechaEvento = new Date("2025-12-28T17:00:00").getTime();

    function actualizarContador() {
      const ahora = new Date().getTime();
      const diferencia = fechaEvento - ahora;

      if (diferencia > 0) {
        const dias = Math.floor(diferencia / (1000 * 60 * 60 * 24));
        const horas = Math.floor((diferencia % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutos = Math.floor((diferencia % (1000 * 60 * 60)) / (1000 * 60));
        const segundos = Math.floor((diferencia % (1000 * 60)) / 1000);

        const update = (id, value) => {
          const el = document.getElementById(id);
          if (el) el.textContent = String(value).padStart(2, "0");
        };

        update("dias", dias);
        update("horas", horas);
        update("minutos", minutos);
        update("segundos", segundos);
      } else {
        ["dias", "horas", "minutos", "segundos"].forEach(id => {
          const el = document.getElementById(id);
          if (el) el.textContent = "00";
        });
      }
    }

    actualizarContador();
    setInterval(actualizarContador, 1000);
  });
</script>